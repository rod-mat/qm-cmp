FROM julia:1.10

# Set working directory
WORKDIR /app

# Copy Project configuration
COPY apps/api/Project.toml ./
# If Manifest exist, copy it too. For now just Project.
# COPY apps/api/Manifest.toml ./

# Install dependencies
RUN julia --project=. -e 'using Pkg; Pkg.instantiate(); Pkg.precompile();'

# Copy Source
COPY apps/api/src ./src

# Expose port
EXPOSE 8080

# Run
CMD ["julia", "--project=.", "src/run.jl"]
