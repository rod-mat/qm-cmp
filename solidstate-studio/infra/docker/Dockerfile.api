FROM julia:1.10

# Set working directory
WORKDIR /app

# Install dependencies manually to avoid registry/Project.toml sync issues
RUN julia --project=. -e 'using Pkg; Pkg.add(["HTTP", "JSON3", "StructTypes", "StaticArrays", "FFTW"]); Pkg.precompile();'

# Copy Source
COPY apps/api/src ./src

# Expose port
EXPOSE 8080

# Run
CMD ["julia", "--project=.", "src/run.jl"]
